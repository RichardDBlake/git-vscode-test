<!doctype html>
<html lang=en>
<head>
    <meta charset=utf-8>
    <meta http-equiv=x-ua-compatible content="IE=edge">
    <meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>My Python Development Environment, 2020 Edition - Jacob Kaplan-Moss</title>
    <meta name=description content="For years I’ve noodled around with various setups for a Python development environment. A couple of years ago I wrote about a setup I finally liked; this is an update to that post.
    Bad news: this stuff still isn&amp;rsquo;t stable, and I&amp;rsquo;ve had to make some changes. Good news: the general concepts still hold, and the new tools a generally a bit better. If you&amp;rsquo;re curious about the changes and why I made them, there&amp;rsquo;s a section at the very end about that.…">
    <meta itemprop=name content="My Python Development Environment, 2020 Edition - Jacob Kaplan-Moss">
    <meta itemprop=description content="For years I’ve noodled around with various setups for a Python development environment. A couple of years ago I wrote about a setup I finally liked; this is an update to that post.
    Bad news: this stuff still isn&amp;rsquo;t stable, and I&amp;rsquo;ve had to make some changes. Good news: the general concepts still hold, and the new tools a generally a bit better. If you&amp;rsquo;re curious about the changes and why I made them, there&amp;rsquo;s a section at the very end about that.…">
    <meta itemprop=image content="https://jacobian.org/cards/python-environment-2020.png">
    <meta property="og:url" content="https://jacobian.org/2019/nov/11/python-environment-2020/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="My Python Development Environment, 2020 Edition - Jacob Kaplan-Moss">
    <meta property="og:description" content="For years I’ve noodled around with various setups for a Python development environment. A couple of years ago I wrote about a setup I finally liked; this is an update to that post.
    Bad news: this stuff still isn&amp;rsquo;t stable, and I&amp;rsquo;ve had to make some changes. Good news: the general concepts still hold, and the new tools a generally a bit better. If you&amp;rsquo;re curious about the changes and why I made them, there&amp;rsquo;s a section at the very end about that.…">
    <meta property="og:image" content="https://jacobian.org/cards/python-environment-2020.png">
    <meta name=twitter:card content="summary_large_image">
    <meta name=twitter:title content="My Python Development Environment, 2020 Edition - Jacob Kaplan-Moss">
    <meta name=twitter:description content="For years I’ve noodled around with various setups for a Python development environment. A couple of years ago I wrote about a setup I finally liked; this is an update to that post.
    Bad news: this stuff still isn&amp;rsquo;t stable, and I&amp;rsquo;ve had to make some changes. Good news: the general concepts still hold, and the new tools a generally a bit better. If you&amp;rsquo;re curious about the changes and why I made them, there&amp;rsquo;s a section at the very end about that.…">
    <meta name=twitter:image content="https://jacobian.org/cards/python-environment-2020.png">
    <link rel=stylesheet href=/main.css>
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,400i,700,700i|Roboto+Condensed:300,400,700|Source+Code+Pro:400,700" rel=stylesheet>
    <link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
    <link rel=stylesheet href=/littlefoot/littlefoot.css>
</head>
<body class="font-serif antialiased tracking-wide bg-tan">
    <div class=jkm-header-background>
        <header class="container py-8 mx-auto lg:flex">
            <h1 class="inline-block px-4 text-3xl font-bold tracking-tighter text-orange-500 bg-black rounded-md lg:text-4xl">
                <a href=/>Jacob Kaplan-Moss</a>
            </h1>
            <nav class="pt-5 font-sans font-bold uppercase lg:flex-1 lg:text-right">
                <ul>
                    <li class=inline>
                        <a class=nav-link href=/posts/>Archive</a>
                    </li>
                    <li class=inline>
                        <a class=nav-link rel=me href=https://github.com/jacobian title=github>
                            <i class="fab fa-github"></i>
                        </a>
                    </li>
                    <li class=inline>
                        <a class=nav-link rel=me href=https://twitter.com/jacobian title=twitter>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </li>
                    <li class=inline>
                        <a class=nav-link rel=me href=https://instagram.com/jacobian title=instagram>
                            <i class="fab fa-instagram"></i>
                        </a>
                    </li>
                    <li class=inline>
                        <a class=nav-link rel=me href=https://linkedin.com/in/jacobian title=linkedin>
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </header>
    </div>
    <div class="container mx-auto mt-4">
        <main class="mt-6 lg:flex">
            <article class="leading-7 tracking-tight lg:w-2/3 lg:pr-4">
                <p class="mb-1 font-sans text-2xl font-light tracking-tighter leighting-tight">
                    <a class=shadow-none href=https://jacobian.org/series/python-development-environment/>My Python Development Environment</a>
                    :
                </p>
                <h1 class="mb-4 text-4xl font-light leading-tight tracking-tighter">My Python Development Environment, 2020 Edition</h1>
                <p>
                    For years I’ve noodled around with various setups for a Python
                    development environment. A couple of years ago 
                    <a href=https://jacobian.org/2018/feb/21/python-environment-2018/>I wrote about a setup I
                    finally
                    liked</a>
                    ; this
                    is an update to that post.
                </p>
                <p>
                    Bad news: this stuff still isn&rsquo;t stable, and I&rsquo;ve had to make some
                    changes. Good news: the general concepts still hold, and the new tools a
                    generally a bit better. If you&rsquo;re curious about the changes and why I
                    made them, there&rsquo;s a 
                    <a href=#changes-since-2018>section at the very end</a>

                    about that.
                </p>
                <p>
                    My setup pieces together 
                    <a href=https://github.com/pyenv/pyenv>pyenv</a>
                    ,
                    <a href=https://poetry.eustace.io/>poetry</a>
                    , and
                    <a href=https://pypi.org/project/pipx/>pipx</a>
                    . It’s probably a tad more complex
                    than is ideal for most Python users, but for the things I need, it’s
                    perfect.
                </p>
                <h3 id=my-requirements>My Requirements</h3>
                <p>I do have somewhat specific (maybe unusual?) requirements:</p>
                <ul>
                    <li>I need to develop against multiple Python versions - various Python
                    3 versions (3.6, 3.7, 3.8, mostly), PyPy, and occasionally Python
                    2.7 (less and less often, thankfully).</li>
                    <li>I work on many projects simultaneously, each with different sets of
                    dependencies, so some sort of virtual environment or isolation is
                    critical.</li>
                    <li>
                        I use multiple OSes: macOS at work, and Linux (well, Linux-ish -
                        actually it’s
                        <a href=https://docs.microsoft.com/en-us/windows/wsl/about>WSL</a>
                        ) at home.
                    </li>
                    <li>I want to avoid using the System-provided Python. On macOS it’s too
                    outdated. On Linux, the system Python is used by the OS itself, so
                    if you hose your Python you can hose your system.</li>
                    <li>
                        I use a bunch Python-based CLI stuff, like
                        <a href=https://rg3.github.io/youtube-dl/>youtube-dl</a>
                        ,
                        <a href=https://aws.amazon.com/cli/>awscli</a>
                        ,
                        <a href=https://doc2dash.readthedocs.io/en/stable/>doc2dash</a>
                        , etc. I want
                        to be able to install and use them without fussing around with
                        activating environments, but I also don’t want their dependencies to
                        clutter up a global installation.
                    </li>
                    <li>I usually deploy through a Docker-based deployment, either to
                    Heroku, AWS, or GCP.</li>
                    <li>Although Docker meets all these requirements, I don’t really like
                    using it. I find it slow, frustrating, and overkill for my purposes.</li>
                </ul>
                <h3 id=the-setup>The Setup</h3>
                <h4 id=1-pyenvhttpsgithubcompyenvpyenv>
                    1. 
                    <a href=https://github.com/pyenv/pyenv>pyenv</a>
                </h4>
                <p>
                    <strong>Why?</strong>
                     I need to run multiple Python versions, isolated from the
                    system Python. 
                    <code>pyenv</code>
                     makes it easy to install, manage, and switch
                    between those multiple Pythons.
                </p>
                <p>
                    On my Mac, I installed 
                    <code>pyenv</code>
                     from Homebrew (
                    <code>brew install pyenv</code>
                    ). On
                    Linux, I used the 
                    <a href=https://github.com/pyenv/pyenv#basic-github-checkout>Github installation technique documented in the
                    installation
                    instructions</a>
                    ,
                    which was easy and went smoothly.
                </p>
                <p>Then, I installed some Python versions:</p>
                <pre>
                    <code>$ pyenv install 3.8.0
                    $ pyenv install 3.7.4
                    $ pyenv install 3.6.9
                    $ pyenv install 2.7.16
                    $ pyenv install pypy3.6-7.1.1
                    </code>
                </pre>
                <p>And made sure my default Python was set to the latest and greatest:</p>
                <pre>
                    <code>$ pyenv global 3.8.0
                    </code>
                </pre>
                <h4 id=2-pipxhttpspypiorgprojectpipx>
                    2. 
                    <a href=https://pypi.org/project/pipx/>pipx</a>
                </h4>
                <p>
                    <strong>Why?</strong>
                    <code>pipx</code>
                     lets me install Python-based CLI stuff
                    (
                    <a href=https://rg3.github.io/youtube-dl/>youtube-dl</a>
                    ,
                    <a href=https://aws.amazon.com/cli/>awscli</a>
                    ,
                    <a href=https://doc2dash.readthedocs.io/en/stable/>doc2dash</a>
                    , etc.) without
                    those projects’ dependencies messing up my global Python.
                </p>
                <p>
                    Installing 
                    <code>pipx</code>
                     is easy:
                </p>
                <pre>
                    <code>$ python -m pip install pipx
                    </code>
                </pre>
                <p>
                    (The documentation suggests installing with 
                    <code>--user</code>
                    . That&rsquo;s probably a
                    good idea for most people. I didn&rsquo;t because I know I&rsquo;m going to keep my
                    global namespace clean, but YMMV.)
                </p>
                <p>From there, I can easily install isolated CLI utils:</p>
                <pre>
                    <code>$ pipx install visidata
                    </code>
                </pre>
                <p>
                    <code>pipx</code>
                     protiop: if you have tools with optional dependencies, like
                    <a href=http://visidata.org/>visidata</a>
                    , you can inject them into the 
                    <code>pipx</code>

                    virtualenv like so:
                </p>
                <pre>
                    <code>$ pipx inject visidata pandas
                    </code>
                </pre>
                <h4 id=3-poetryhttpspoetryeustaceio>
                    3. 
                    <a href=https://poetry.eustace.io/>Poetry</a>
                </h4>
                <p>Why? Poetry handles dependency- and virtual-environment-management in a
                way that’s very intuitive (to me), and fits perfectly with my desired
                workflow.</p>
                <p>
                    <a href=https://poetry.eustace.io/docs/#installation>The documentation covers a few different ways to install
                    Poetry</a>
                    . Because I’m using
                    <code>pipx</code>
                    , I use that:
                </p>
                <pre>
                    <code>$ pipx install poetry==1.0.0b4
                    </code>
                </pre>
                <p>
                    Note that I&rsquo;m using the 1.0 pre-release (
                    <code>1.0.0b4</code>
                     at the time of this
                    writing). It&rsquo;s a tradeoff: the pre-releases have generally better
                    ergonomics and fewer bugs, but are bleeding edge. I&rsquo;ve already had one
                    bug break some automated releases. So think carefully about using the
                    stable version vs the new shiny.
                </p>
                <p>
                    To start new projects, I just make a directory and type 
                    <code>poetry init</code>
                    .
                    This guides me to create a 
                    <code>pyproject.toml</code>
                    . Then I&rsquo;ll run 
                    <code>poetry install</code>
                    , which&rsquo;ll create a managed virtualenv for me and install stuff
                    into it.
                </p>
                <p>
                    To work on existing projects, I clone a repository and then run 
                    <code>poetry install</code>
                    .
                </p>
                <p>
                    If you&rsquo;re new to Poetry, and want to see an example of what a project
                    using it looks like, my
                    <a href=https://github.com/jacobian/pinboard-to-sqlite>pinboard-to-sqlite</a>

                    repo is a good fairly simple example.
                </p>
                <p>
                    Converting to Poetry from a 
                    <code>requirements.txt</code>
                     is a bit frustrating: I
                    have to manually consult the requirements file, and run 
                    <code>poetry add {package}</code>
                    , possibly with a version specifier, until I get an
                    appropriate 
                    <code>pyproject.toml</code>
                    .
                </p>
                <p>
                    If I need to switch Python versions, I run 
                    <code>pyenv local &lt;version></code>
                     in my
                    project directory.
                </p>
                <h4 id=deployment>Deployment</h4>
                <p>
                    When it comes time to deploy, Heroku&rsquo;s native buildpacks don&rsquo;t
                    understand 
                    <code>pyproject.toml</code>
                     😠. However, I&rsquo;m increasingly moving to
                    Docker-based deploys, even to Heroku. Getting Poetry going in a Docker
                    image is a bit finicky, but it&rsquo;s not bad. I do something like this:
                </p>
                <pre>
                    <code>FROM python:3.7

                    WORKDIR /code

                    RUN pip install -U pip &amp;&amp; \
                        pip install poetry

                    COPY poetry.lock pyproject.toml ./
                    COPY src/ ./src/

                    # Install poetry globally - with the current version of
                    # poetry, there is a known issue where poetry config will
                    # not create config.toml: https://github.com/sdispater/poetry/issues/1179
                    # As such, we create it ourselves.
                    RUN mkdir -p ${HOME}/.config/pypoetry/ &amp;&amp; \
                        touch ${HOME}/.config/pypoetry/config.toml &amp;&amp; \
                        poetry config settings.virtualenvs.create false &amp;&amp; \

                    # Set PRODUCTION to anything to invoke installation with --no-dev
                    ARG PRODUCTION
                    RUN poetry install ${PRODUCTION:+--no-dev}
                    </code>
                </pre>
                <h3 id=changes-since-2018>Changes since 2018</h3>
                <p>
                    If you read my 
                    <a href=https://jacobian.org/2018/feb/21/python-environment-2018/>2018
                    version</a>
                    ,
                    you&rsquo;ll note that while the general architecture remains the same, two
                    out of the three tools have changed:
                </p>
                <ul>
                    <li>
                        <p>
                            <a href=https://github.com/mitsuhiko/pipsi/>pipsi</a>
                             →
                            <a href=https://pypi.org/project/pipx/>pipx</a>
                            . This change is simple:
                            <code>pipsi</code>
                             is no longer maintained. 
                            <code>pipx</code>
                             does the same thing, but is
                            actively maintained.
                        </p>
                    </li>
                    <li>
                        <p>
                            <a href=https://pipenv.readthedocs.io/en/latest/>pipenv</a>
                             →
                            <a href=https://poetry.eustace.io/>poetry</a>
                            . This move&rsquo;s more complex. I
                            stoped using Pipenv for a couple of reasons:
                        </p>
                        <ul>
                            <li>Governance: the lead of Pipenv was someone with a history of not
                            treating his collaborators well. That gave me some serious
                            concerns about the future of the project, and of my ability to
                            get bugs fixed.</li>
                            <li>Bugs and rapid API changes. About a year ago, Pipenv had lots of
                            bugs, and a rapid pace of change introducing or changing APIs. I
                            ran into minor issues at least once a week. Nothing was
                            seriously bad, but it generally felt fairly unstable. I kept
                            having to update various automated deploy workflows to work
                            around issues or changes to Pipenv.</li>
                        </ul>
                        <p>Between the two, I lost confidence in Pipenv and switch to Poetry.
                        Since then, the governance issue has been fixed — the person I was
                        concerned about stepped away. The quality issues may have been fixed
                        as well, I&rsquo;m not sure. Poetry works fine, so I&rsquo;m sticking with it
                        for now. Watch for the 2022 version of this post when I switch back.
                        (I really hope I&rsquo;m joking!)</p>
                    </li>
                </ul>
            </article>
            <aside class="pt-6 mt-6 text-xs leading-relaxed border-t border-gray-800 border-dotted lg:mt-0 lg:pt-0 lg:border-t-0 lg:pl-2 lg:border-l lg:w-1/3">
                <p class="p-4 mb-6 leading-loose rounded-md bg-tan-bright">
                    Hi, I'm Jacob aka 
                    <a href=https://twitter.com/jacobian/>@jacobian</a>
                    .
                    If you're looking to contact me, 
                    <a href=/help/>here are some ways
                    I can help</a>
                    . If you want to find out when I've posted new
                    articles, you can subcribe to my 
                    <a href=/index.xml>RSS feed</a>
                     or
                    <a href=/newsletter/>email newsletter</a>
                    .
                </p>
                <h2 class=text-base>
                    Published 
                    <span class=whitespace-no-wrap>November 11th, 2019
                    </span>
                    .</p>
                    <p class=mt-6>
                    <h2 class="mb-1 text-base">Table of Contents:</h2>
                    <nav id=TableOfContents>
                        <ul>
                            <li>
                                <ul>
                                    <li>
                                        <a href=#my-requirements>My Requirements</a>
                                    </li>
                                    <li>
                                        <a href=#the-setup>The Setup</a>
                                    </li>
                                    <li>
                                        <a href=#changes-since-2018>Changes since 2018</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    </p>
                    <p class=mt-6>
                    <h2 class="inline mr-1 text-base">Tags:</h2>
                    <ul class=inline>
                        <li class="inline mr-1">
                            <a href=https://jacobian.org/tags/python/>python</a>
                        </li>
                        <li class="inline mr-1">
                            <a href=https://jacobian.org/tags/environment/>environment</a>
                        </li>
                    </ul>
                    </p>
                    <p class=mt-6>
                    <h2 class="inline text-base">
                        Part of the 
                        <a href=https://jacobian.org/series/python-development-environment/>My Python Development Environment</a>
                         series.
                        All articles in this series:
                    </h2>
                    <ol class=mt-1>
                        <li class="pl-1 ml-5 list-decimal list-outside">
                            <a href=https://jacobian.org/2018/feb/21/python-environment-2018/>My Python Development Environment, 2018 Edition</a>
                        </li>
                        <li class="pl-1 ml-5 list-decimal list-outside">
                            <b>My Python Development Environment, 2020 Edition</b>
                        </li>
                    </ol>
                    </p>
                    <p>
                    <h2 class="mt-6 mb-1 text-base">Next by date:</h2>
                    <a class=next href=https://jacobian.org/2020/jan/5/psa-now-on-cloud-run/>📣 Now on Google Cloud Run</a>
                    </p>
                    <p>
                    <h2 class="mt-6 mb-1 text-base">Previous by date:</h2>
                    <a class=previous href=https://jacobian.org/2019/apr/23/questions-for-employers-director-vp/>My questions for prospective employers (Director/VP roles)</a>
                    </p>
                    <p>
                    <h2 class="mt-6 text-base">The Algorithm thinks these articles are similar:</h2>
                    <ul>
                        <li class="mt-1 ml-5 list-disc list-outside">
                            <a href=/2018/feb/21/python-environment-2018/>My Python Development Environment, 2018 Edition</a>
                        </li>
                    </ul>
                    </p>
            </aside>
        </main>
    </div>
    <footer class="container mx-auto text-center">
        <p class="mt-10 mb-4 text-xs text-gray-800">© Jacob Kaplan-Moss</p>
    </footer>
    <script type=text/javascript src=/littlefoot/littlefoot.js></script>
    <script type=text/javascript>
    littlefoot.littlefoot({
        scope: "main article"
    }),
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll("article h2[id], article h3[id], article h4[id]").forEach(b => {
            let a = document.createElement('a');
            a.href = '#' + b.id,
            a.innerHTML = '<i class="fas fa-link"></i>',
            a.classList.add('reflink', 'hidden', 'text-lg', 'ml-2', 'leading-none'),
            b.insertAdjacentElement("beforeend", a)
        })
    })
    </script>
    <script async defer src="https://sa.jacobian.org/latest.js"></script>
    <noscript>
        <img src="https://sa.jacobian.org/noscript.gif" alt=""/>
    </noscript>
</body>
</html>

